Patching kivan/setup-kivan.tp2: GAME_IS ~soa tob bgt bg2ee~  => GAME_IS ~soa tob bgt bg2ee eet~ 
Patching kivan/setup-kivan.tp2: GAME_IS BG2EE THEN BEGIN => GAME_IS ~BG2EE eet~ THEN BEGIN
Patching kivan/setup-kivan.tp2: GAME_IS ~tob bgt bg2ee~ THEN BEGIN => GAME_IS ~tob bgt bg2ee eet~ THEN BEGIN
Patching kivan/setup-kivan.tp2: GAME_IS bg2ee => GAME_IS ~bg2ee eet~
Patching kivan/setup-kivan.tp2: GAME_IS ~tob bgt bg2ee~ THEN BEGIN => GAME_IS ~tob bgt bg2ee eet~ THEN BEGIN
Patching kivan/setup-kivan.tp2: GAME_IS ~bg2ee~ BEGIN => GAME_IS ~bg2ee eet~ BEGIN
Patching kivan/setup-kivan.tp2: GAME_IS ~tob bgt bg2ee~ THEN BEGIN => GAME_IS ~tob bgt bg2ee eet~ THEN BEGIN
Patching kivan/setup-kivan.tp2: GAME_IS ~tob bgt bg2ee~ THEN BEGIN => GAME_IS ~tob bgt bg2ee eet~ THEN BEGIN
Patching kivan/setup-kivan.tp2: GAME_IS ~tob bgt bg2ee~ THEN BEGIN  => GAME_IS ~tob bgt bg2ee eet~ THEN BEGIN 
Patching kivan/setup-kivan.tp2: GAME_IS ~bg2ee~ BEGIN => GAME_IS ~bg2ee eet~ BEGIN
Patching kivan/baf/p#anom.baf: Global("Chapter","GLOBAL",2) => Global("Chapter","GLOBAL",%bg2_chapter_2%)
Patching kivan/baf/p#ar0700.baf: GlobalLT("Chapter","GLOBAL",2) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_2%)
Patching kivan/baf/p#kiribf.baf: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/baf/p#kiv01.baf: GlobalGT("Chapter","GLOBAL",7) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_7%)
Patching kivan/baf/p#kiv01.baf: GlobalLT("Chapter","GLOBAL",5) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/baf/p#kiv01.baf: GlobalGT("Chapter","GLOBAL",4) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/baf/p#kiv01.baf: GlobalLT("Chapter","GLOBAL",5) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/baf/p#kiv01.baf: GlobalGT("Chapter","GLOBAL",1) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_1%)
Patching kivan/baf/p#kiv01.baf: GlobalGT("Chapter","GLOBAL",1) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_1%)
Patching kivan/baf/p#kiv01.baf: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/baf/p#kiv01.baf: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/baf/p#kiv01.baf: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/baf/p#kiv01.baf: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/baf/p#kivd.baf: GlobalLT("Chapter","GLOBAL",6) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_6%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kiitm.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kinew.d: GlobalGT("Chapter","GLOBAL",4) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kinew.d: GlobalLT("Chapter","GLOBAL",6) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_6%)
Patching kivan/d/p#kinew.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",5) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kipid.d: GlobalGT("Chapter","GLOBAL",4) => GlobalGT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/d/p#kivj.d: GlobalLT("Chapter","GLOBAL",3) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_3%)
Patching kivan/d/p#kivj.d: Global("chapter","GLOBAL",2) => Global("chapter","GLOBAL",%bg2_chapter_2%)
Patching kivan/d/p#kivj.d: Global("chapter","GLOBAL",2) => Global("chapter","GLOBAL",%bg2_chapter_2%)
Patching kivan/d/p#kivj.d: Global("chapter","GLOBAL",2) => Global("chapter","GLOBAL",%bg2_chapter_2%)
Patching kivan/d/p#kivsoa.d: GlobalLT("Chapter","GLOBAL",3) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_3%)
Patching kivan/d/p#kivsoa.d: GlobalLT("Chapter","GLOBAL",5) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_5%)
Patching kivan/d/p#kivsoa.d: GlobalLT("Chapter","GLOBAL",4) => GlobalLT("Chapter","GLOBAL",%bg2_chapter_4%)
Patching kivan/setup-kivan.tp2: ALWAYS command expanded
  ACTION_IF GAME_IS ~eet~ BEGIN
    OUTER_SET bg2_chapter = 12
  END ELSE BEGIN
    OUTER_SET bg2_chapter = 0
  END
  OUTER_FOR (i=1; i<=10; i=i+1) BEGIN
    OUTER_SET bg2_chapter = bg2_chapter + 1
    OUTER_SPRINT name_source ~bg2_chapter_%i%~
    OUTER_SET EVAL ~%name_source%~ = bg2_chapter
  END

-----------------

Manual edits:

2. Below code from kivan/d/p#ki25j.d:

//Spirit of Fate

EXTEND_TOP FATESP 6
+ ~!InMyArea("P#KIVAN")
Global("P#KivanSummoned","GLOBAL",0)~ + @164 DO ~SetGlobal("P#KivanSummoned","GLOBAL",2)~ + 10
+ ~!InMyArea("P#DEHER")
Global("P#DeherianaSummoned","GLOBAL",0)~ + @165 DO ~SetGlobal("P#DeherianaSummoned","GLOBAL",2)~ + P#FSDehDead
END

APPEND FATESP

IF ~~ P#FSDehDead
SAY @166
IF ~~ THEN GOTO 6
END
END

Moved to new file: kivan/d/FATESP.d

3. New code added at the end of ajantisbg2/setup-ajantisbg2.tp2

ACTION_IF GAME_IS ~eet~ BEGIN
  INCLUDE ~EET/other/EET_functions.tph~
  LAF ~EET_NPC_TRANSITION~
    INT_VAR
      type = 2
      clean_ToB = 1
    STR_VAR
      dv = "P#KIVAN"
      override_SoA = "P#KIVAN"
      override_ToB = "P#KI25"
      dialog_ToB = "P#KI25P" //unfortunately ToB starting dialogue doesn't exist
      traFile = EVAL "Kivan/tra/%LANGUAGE%/p#ki25j.tra"
      string = "@164" //Bring me Kivan, the elven archer.
      stringPosDV = "Korgan"
      clean_ToB_DV = "Kivan"
  END
  LAF ~EET_NPC_TRANSITION~
    INT_VAR
      type = 2
    STR_VAR
      dv = "P#DEHER"
      override_SoA = "P#DEH01"
      override_ToB = "P#DE25"
      dialog_ToB = "P#DE25P" //unfortunately ToB starting dialogue doesn't exist
      traFile = EVAL "Kivan/tra/%LANGUAGE%/p#ki25j.tra"
      string = "@165" //Bring me Deheriana, the elven mage.
      stringPosDV = "Dorn"
  END
END ELSE BEGIN
  COMPILE ~Kivan/d/FATESP.d~ USING ~Kivan/tra/%LANGUAGE%/p#ki25j.tra~
END


//For better compatibility Kivan and Deheraiana should have unique ToB starting dialogue when summoned by fatesp but since it doesn't exist I had to assign ToB post dialogue files. Notice that summoning is only possible if you had them in party before and they are not death. You can't just tell that they died when player can vnist old areas and find them

This file doesn't document EVALUATE_BUFFER additions. The command is added if script or dialogue needs evaluation due to chapters variables usage
